(()=>{var e={apiKey:null,questionMatrix:{},refreshCounts:{},lastRefreshTimes:{},tooltipsEnabled:!0,tooltipRefGlobal:null,speedDialRef:null,temporaryTooltipRef:null,activeFetches:0,speedDialEnabledGlobal:!0,selectedLang:"en",speedDialPosition:"bottom-right",isRecording:!1,isPaused:!1,recordingStartTime:null,mediaRecorder:null,recordedChunks:[],isCameraEnabled:!1,isMicEnabled:!1,userStream:null,screenStream:null,businessSettings:null,originalTextNodes:new Map};function t(t){e.questionMatrix={...e.questionMatrix,...t}}function n(t){return e.questionMatrix[t]}function o(t){return e.refreshCounts[t]||0}function i(){e.refreshCounts={},e.lastRefreshTimes={}}function s(t){e.tooltipRefGlobal=t}function a(t){e.temporaryTooltipRef=t}var r={synth:window.speechSynthesis,voices:[],voicesLoaded:!1};function l(){if(r.synth)try{r.voices=r.synth.getVoices(),r.voices.length>0&&(r.voicesLoaded=!0)}catch(e){console.warn("Error getting TTS voices:",e),r.voices=[],r.voicesLoaded=!1}}function d(t,n=null){if(!r.synth||!t)return;r.synth.speaking&&r.synth.cancel();const o=n||e.selectedLang||document.documentElement.lang||navigator.language||"en-US",i=o.includes("-")?`${o.split("-")[0].toLowerCase()}-${o.split("-")[1].toUpperCase()}`:o.toLowerCase(),s=i.split("-")[0],a=new SpeechSynthesisUtterance(t);a.lang=i;let d=null;r.voicesLoaded&&r.voices.length>0?(d=r.voices.find(e=>e.lang===i),d||(d=r.voices.find(e=>e.lang.startsWith(s+"-"))),d||(d=r.voices.find(e=>e.lang===s))):r.voicesLoaded||(l(),r.voicesLoaded&&r.voices.length>0&&(d=r.voices.find(e=>e.lang===i)||r.voices.find(e=>e.lang.startsWith(s+"-"))||r.voices.find(e=>e.lang===s))),d?a.voice=d:r.voices.length,a.onerror=e=>{console.warn(`SpeechSynthesisUtterance Error for lang ${a.lang}:`,e.error)};try{r.synth.speak(a)}catch(e){console.warn("Failed to speak:",e)}}function c(){if(r.synth&&r.synth.speaking)try{r.synth.cancel()}catch(e){console.warn("Error cancelling speech:",e)}}function p(){return!!r.synth}var u="http://localhost:8000/api",g=`${u}/question-lookup`,m=`${u}/support-query`,f=`${u}/video-upload`,h=`${u}/languages`,b=`${u}/business`,y=`${u}/translate-page`,v='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="currentColor">\n        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>\n        <path d="M0 0h24v24H0z" fill="none"/>\n    </svg>',w='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M17.65 6.35A7.95 7.95 0 0 0 12 4C8.74 4 6 6.03 4.69 9h2.02a6.011 6.011 0 0 1 10.09-1.24l-1.81 1.81H20V4l-2.35 2.35zM6.35 17.65A7.95 7.95 0 0 0 12 20c3.26 0 6-2.03 7.31-5h-2.02a6.011 6.011 0 0 1-10.09 1.24l1.81-1.81H4v4l2.35-2.35z"/></svg>',x='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>',E='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',C='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>',S="simpleform_sdk_persistent_lang",T="simpleform_sdk_tooltips_enabled",k="simpleform_sdk_speed_dial_position",L='form input:not([type="hidden"]):not([type="submit"]):not([type="reset"]):not([type="button"]):not([type="image"]):not(:disabled), form textarea:not(:disabled), form select:not(:disabled)',R='form input:not([type="hidden"]), form textarea, form select';function B(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function A(e){if(e.labels&&e.labels.length>0&&e.labels[0].textContent.trim())return e.labels[0].textContent.trim();if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t&&t.textContent.trim())return t.textContent.trim()}if(e.dataset.tooltipKey&&e.dataset.tooltipKey.trim())return e.dataset.tooltipKey.trim();const t=e.name||e.id||null;if(t)return t;if("select"===e.tagName.toLowerCase()){if(e.options&&e.options.length>0){for(let t=0;t<e.options.length;t++){const n=e.options[t].text.trim();if(n&&!/^(select|choose|\-\-|please select|select an option)/i.test(n)&&""!==e.options[t].value)return n}const t=e.options[0]?.text.trim();return t||"Select field"}return"Select field"}if(e.placeholder&&e.placeholder.trim())return e.placeholder.trim();const n=e.getAttribute("aria-label");if(n&&n.trim())return n.trim();const o=e.getAttribute("aria-labelledby");if(o){const e=document.getElementById(o);if(e&&e.textContent.trim())return e.textContent.trim()}return null}let I=null;function M(){[e.screenStream,e.userStream].forEach(e=>{e&&e.getTracks().forEach(e=>e.stop())}),e.screenStream=null,e.userStream=null,I&&(I.remove(),I=null)}async function P(){e.isRecording||(e.recordedChunks=[]),M();try{e.screenStream=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen"},audio:!0});try{e.userStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})}catch(e){}const t=[...e.screenStream.getTracks()];e.userStream&&e.userStream.getTracks().forEach(e=>t.push(e));const n=e.screenStream.getVideoTracks()[0];n&&(n.onended=()=>{const e=document.getElementById("eraseBtn");e&&e.click()});const{mimeType:o,extension:i}=function(){const e=["video/mp4; codecs=avc1","video/webm; codecs=vp9","video/webm"];for(const t of e)if(MediaRecorder.isTypeSupported(t)){const e=t.includes("mp4")?"mp4":"webm";return{mimeType:t,extension:e}}return{mimeType:"video/webm",extension:"webm"}}(),s=new MediaStream(t);e.mediaRecorder=new MediaRecorder(s,{mimeType:o});const a=e.userStream?.getVideoTracks()[0];a&&(a.enabled=e.isCameraEnabled);const r=e.userStream?.getAudioTracks()[0];r&&(r.enabled=e.isMicEnabled),a&&(I=document.createElement("video"),I.srcObject=new MediaStream([a]),I.autoplay=!0,I.muted=!0,Object.assign(I.style,{position:"fixed",bottom:"20px",left:"20px",width:"200px",height:"150px",borderRadius:"8px",border:"2px solid #fff",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",zIndex:2147483647,objectFit:"cover",display:e.isCameraEnabled?"block":"none"}),document.body.appendChild(I)),e.mediaRecorder.ondataavailable=t=>{t.data.size>0&&e.recordedChunks.push(t.data)},e.mediaRecorder.onstop=()=>{if(e.recordedChunks.length>0){(function(e,t="recording.webm"){if(console.log("[API] sendVideoRecording called."),!e||0===e.size){const e=new Error("Cannot send empty video file.");return console.error("[API] Validation failed:",e),Promise.reject(e)}console.log("[API] Video blob to be sent:",e),console.log(`[API] Filename: ${t}`);const n=new FormData;n.append("video",e,t),console.log("[API] FormData created:",n);for(let[e,t]of n.entries())console.log(`[API] FormData entry: ${e}`,t);return fe(f,{method:"POST",headers:{Accept:"application/json"},body:n}).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}return e.json()}).catch(e=>{throw console.error("Video upload failed:",e),e})})(new Blob(e.recordedChunks,{type:o}),`recording.${i}`).then(e=>{}).catch(e=>{})}M(),e.isRecording=!1},e.mediaRecorder.start(),e.isRecording=!0,e.isPaused=!1,e.recordingStartTime=Date.now()}catch(e){throw M(),e}}function z(){return I}var D=null,F=!1,H=null,$=null,O=null;function N(){const e=document.createElement("div");e.id="form-tooltip-container",Object.assign(e.style,{position:"fixed",top:"0",left:"0",width:"0",height:"0",pointerEvents:"none",zIndex:2147483647}),document.body.appendChild(e);const t=e.attachShadow({mode:"open"}),n=document.createElement("style");n.textContent="\n        .tooltip {\n            position: absolute !important; padding: 4px 8px !important;\n            background-color: rgba(0, 0, 0, 0.85) !important; color: #fff !important;\n            border-radius: 4px !important; font-size: 12px !important;\n            font-family: sans-serif !important; display: none;\n            pointer-events: auto !important; white-space: normal !important;\n            max-width: 250px !important; word-wrap: break-word !important;\n            z-index: 1 !important; box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n            line-height: 1.4;\n        }\n        .tooltip button {\n            margin-left: 8px; cursor: pointer; border: none;\n            background: transparent; color: #a7a7a7; font-size: 11px;\n            border-radius: 3px; pointer-events: auto; vertical-align: middle;\n            padding: 0; line-height: 1;\n        }\n        .tooltip button:hover { color: #ffffff; }\n        .tooltip button svg { display: block; vertical-align: middle; }\n        .tooltip button:disabled { cursor: not-allowed; opacity: 0.4; color: #777777 !important; }\n        .tooltip-text { vertical-align: middle; }\n    ",t.appendChild(n);const o=document.createElement("div");return o.classList.add("tooltip"),o.setAttribute("role","tooltip"),t.appendChild(o),o.addEventListener("mouseenter",()=>{F||K()}),o.addEventListener("mouseleave",()=>{F||G(700)}),{container:e,tooltip:o,shadow:t}}function j(){$&&(document.removeEventListener("click",$,!0),$=null),F=!1,H=null,e.tooltipRefGlobal&&e.tooltipRefGlobal.tooltip&&e.tooltipRefGlobal.tooltip.removeAttribute("data-sticky")}function q(){e.tooltipRefGlobal&&e.tooltipRefGlobal.tooltip&&(e.tooltipRefGlobal.tooltip.style.display="none",c())}function V(){q(),j(),K(),O=null}function _(i,s,a=!1){if(!e.tooltipsEnabled||!e.tooltipRefGlobal||!e.tooltipRefGlobal.tooltip)return;const r=e.tooltipRefGlobal.tooltip,l=p(),c=s.dataset.keyUsed,u=n(c)||"No information available for this field.";r.innerHTML="";const g=document.createElement("span");g.classList.add("tooltip-text"),g.textContent=u,r.appendChild(g);const m=document.createElement("button");m.setAttribute("aria-label","Refresh definition"),m.innerHTML=w;if(o(c)>=3?(m.disabled=!0,m.setAttribute("title","Refresh limit reached (3 max)")):m.setAttribute("title","Refresh definition"),m.addEventListener("click",i=>{if(i.stopPropagation(),m.disabled)return;F||a||K();const s=Date.now(),l=(d=c,e.lastRefreshTimes[d]||0);var d;if(s-l<5e3){const e=((5e3-(s-l))/1e3).toFixed(1),t=g.textContent;return g.textContent=`Wait ${e}s...`,setTimeout(()=>{"block"===r.style.display&&r.contains(g)&&g.textContent===`Wait ${e}s...`&&(g.textContent=t)},1500),void(F||a||G(700))}!function(t,n){e.lastRefreshTimes[t]=n}(c,s),g.textContent="Refreshing...",m.disabled=!0,he([c]).then(o=>{o&&o[c]?(t({[c]:o[c]}),"block"===r.style.display&&r.contains(g)&&(g.textContent=o[c]),function(t){e.refreshCounts[t]=(e.refreshCounts[t]||0)+1}(c)):"block"===r.style.display&&r.contains(g)&&(g.textContent=n(c)||"Refresh failed.")}).catch(e=>{"block"===r.style.display&&r.contains(g)&&(g.textContent="Error refreshing."),console.log("Error during refresh fetch:",e)}).finally(()=>{o(c)>=3?(r.contains(m)&&(m.disabled=!0),m.setAttribute("title","Refresh limit reached (3 max)")):r.contains(m)&&(m.disabled=!1,m.setAttribute("title","Refresh definition")),F||a||"block"!==r.style.display||K()})}),r.appendChild(m),l){const e=document.createElement("button");e.setAttribute("aria-label","Read tooltip aloud"),e.setAttribute("title","Read aloud"),e.innerHTML=v,e.addEventListener("click",e=>{e.stopPropagation();d(g.textContent,null),F||a||(K(),G(1400))}),r.appendChild(e)}r.style.display="block";const f=i.getBoundingClientRect(),h=r.getBoundingClientRect(),b=window.innerWidth,y=window.innerHeight;let x=f.bottom+8,E=f.left+f.width/2-h.width/2;x+h.height>y-8&&(x=f.top-h.height-8),x<8&&(x=8),E<8&&(E=8),E+h.width>b-8&&(E=b-h.width-8),r.style.top=`${x}px`,r.style.left=`${E}px`}function G(t=300){F||(K(),D=setTimeout(()=>{F||"block"!==e.tooltipRefGlobal.tooltip.style.display||O!==H&&q(),D=null,O=null},t))}function K(){D&&(clearTimeout(D),D=null)}function U(e,t){const n=e.currentTarget;O=n,F&&H===n?K():(K(),q(),_(n,t,!1))}function W(t,n){const o=t.currentTarget;K(),F&&H===o?V():(F&&j(),q(),F=!0,H=o,e.tooltipRefGlobal&&e.tooltipRefGlobal.tooltip&&e.tooltipRefGlobal.tooltip.setAttribute("data-sticky","true"),_(o,n,!0),setTimeout(()=>{F&&H===o&&($=t=>{if(!e.tooltipRefGlobal||!e.tooltipRefGlobal.tooltip)return void j();const n=e.tooltipRefGlobal.tooltip.contains(t.target),o=H&&H.contains(t.target);n||o||V()},document.addEventListener("click",$,!0))},0))}function Y(t){if(!t||"true"===t.dataset.tooltipInjected||!e.tooltipsEnabled)return;if(!t.closest("form")||null===t.offsetParent)return;const o=A(t);if(!o||!n(o))return;t.dataset.keyUsed=o,t.dataset.tooltipInjected="true";const i=document.createElement("span");i.classList.add("tooltip-icon-container"),Object.assign(i.style,{display:"inline-flex",alignItems:"center",marginLeft:"5px",verticalAlign:"middle",position:"relative",zIndex:"1000",cursor:"pointer"});const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","24"),s.setAttribute("height","24"),s.setAttribute("viewBox","0 0 24 24"),s.setAttribute("aria-label","Help Information"),s.setAttribute("role","button"),s.setAttribute("tabindex","0"),s.style.fill="#555",s.style.display="block",s.innerHTML='<path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 16c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm-1-10h2v2h-2zm0 4h2v4h-2z"/><path fill="none" d="M0 0h24v24H0z"/>',s.addEventListener("mouseenter",e=>U(e,t)),s.addEventListener("focus",e=>U(e,t)),s.addEventListener("mouseleave",()=>G()),s.addEventListener("blur",()=>G()),s.addEventListener("click",e=>{e.stopPropagation(),W(e,t)}),s.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),W(e,t))}),i.appendChild(s);t.parentNode;let a=t.id?document.querySelector(`label[for="${t.id}"]`):null;a&&t.nextElementSibling===a?a.insertAdjacentElement("afterend",i):(t.labels&&t.labels.length>0&&t.labels[0],t.insertAdjacentElement("afterend",i))}function J(){e.tooltipsEnabled&&e.tooltipRefGlobal&&document.querySelectorAll(L).forEach(e=>{null!==e.offsetParent&&Y(e)})}function X(){const e=new Set;return document.querySelectorAll(L).forEach(t=>{if(null!==t.offsetParent&&!t.disabled&&t.closest("form")){const n=A(t);n&&e.add(n)}}),Array.from(e)}function Q(){document.querySelectorAll(".tooltip-icon-container").forEach(e=>{let t=e.previousElementSibling;if(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&"SELECT"!==t.tagName){if(e.parentElement){let n=null;const o=Array.from(e.parentElement.childNodes),i=o.indexOf(e);if(i>0){const e=o[i-1];!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&"SELECT"!==e.tagName||(n=e)}n||(n=Array.from(e.parentElement.querySelectorAll("input, textarea, select")).find(t=>t.nextElementSibling===e||t.parentElement.isSameNode(e.parentElement)&&t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)),t=n||t}}else;t&&t.dataset&&(t.dataset.tooltipInjected="false",delete t.dataset.keyUsed),e.remove()})}var Z=null,ee=null,te=null;let ne=null;var oe="ss-panel";async function ie(t,n){if(!n)return;const o=n.host.shadowRoot.getElementById("ss-form").querySelector('button[type="submit"]');n.addMsg("Thinking...","bot"),o.disabled=!0;try{const o=document.body.innerText,i=await function(t,n=""){if("string"!=typeof t||!t.trim())return Promise.resolve("");const o={question:t.trim(),context:n,language:e.selectedLang||null};return fe(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}const t=await e.json();return"string"==typeof t?.answer?t.answer:""}).catch(e=>(console.warn("Support query failed:",e),""))}(t,o);i?n.addMsg(i,"bot"):n.addMsg("Sorry, I couldn't find an answer for that.","error")}catch(e){console.log("[Support Chat] Error during support query fetch:",e),n.addMsg(`Error: ${e.message||"Failed to fetch from support backend."}`,"error")}finally{o.disabled=!1}}function se(){if(document.getElementById(oe)||!document.body)return null;const e=document.createElement("div");e.id="simple-support-host",document.body.appendChild(e);const t=e.attachShadow({mode:"open"});t.innerHTML=`\n    <style>\n      #${oe} {\n        position: fixed;\n        bottom: 95px;\n        right: 20px;\n        width: 330px;\n        max-height: 480px;\n        display: none;\n        flex-direction: column;\n        background: #ffffff;\n        color: #212529;\n        border-radius: 16px;\n        box-shadow: 0 12px 30px rgba(0,0,0,0.12), 0 6px 15px rgba(0,0,0,0.08);\n        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n        z-index: 2147483647;\n        overflow: hidden;\n        transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;\n        opacity: 0;\n        transform: translateY(15px) scale(0.98);\n      }\n      #${oe}.visible {\n        display: flex;\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n      #${oe} header {\n        padding: 16px 20px;\n        background-color: #f7f7f7;\n        border-bottom: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      #${oe} header h2 {\n        margin: 0;\n        font-size: 17px;\n        font-weight: 600;\n        color: #212529;\n      }\n      #${oe} header button {\n        background: transparent; border: none; cursor: pointer;\n        color: #555; padding: 5px; border-radius: 50%;\n      }\n       #${oe} header button:hover { background-color: rgba(0,0,0,0.05); }\n      #ss-chat-messages {\n        flex: 1; overflow-y: auto; padding: 20px;\n        background: #ffffff; display: flex; flex-direction: column; gap: 15px;\n      }\n      .ss-msg {\n        padding: 10px 14px; border-radius: 12px; max-width: 80%;\n        font-size: 14px; line-height: 1.5; word-break: break-word;\n      }\n      .ss-msg.user {\n        align-self: flex-end; background: #116530; color: #fff;\n        border-bottom-right-radius: 4px;\n      }\n      .ss-msg.bot {\n        align-self: flex-start; background: #f0f0f0; color: #212529;\n        border-bottom-left-radius: 4px;\n      }\n      .ss-msg.error {\n        align-self: flex-start; background: #fdecea; color: #611a15;\n      }\n      #ss-form {\n        display: flex; padding: 16px 20px; border-top: 1px solid #e0e0e0;\n        background-color: #f7f7f7;\n      }\n      #ss-input {\n        flex: 1; border: 1px solid #d1d5db; border-radius: 8px;\n        padding: 10px 14px; font-size: 14px; margin-right: 10px;\n        background-color: #fff; color: #333;\n      }\n       #ss-input:focus {\n        border-color: #116530;\n        box-shadow: 0 0 0 2px rgba(17, 101, 48, 0.25);\n       }\n      #ss-form button {\n        background: #D4A017; color: #000; border: none;\n        border-radius: 8px; padding: 10px 14px; cursor: pointer;\n        display: flex; align-items: center; justify-content: center;\n        transition: background-color 0.2s ease;\n      }\n       #ss-form button:hover { filter: brightness(0.9); }\n       #ss-form button svg { fill: #000; }\n    </style>\n    <section id="${oe}">\n      <header>\n        <h2>Support Assistant</h2>\n        <button id="ss-close-btn" aria-label="Close support chat">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>\n        </button>\n      </header>\n      <div id="ss-chat-messages"></div>\n      <form id="ss-form">\n        <input id="ss-input" type="text" placeholder="Ask a question…" aria-label="Support question input"/>\n        <button type="submit" aria-label="Send support question">${x}</button>\n      </form>\n    </section>\n  `;const n=t.getElementById(oe),o=t.getElementById("ss-chat-messages"),i=t.getElementById("ss-form"),s=t.getElementById("ss-input"),a=t.getElementById("ss-close-btn"),r=e=>{e?(n.classList.add("visible"),n.style.display="flex",requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0) scale(1)"}),s.focus(),te?.panel.classList.contains("visible")&&re(!1)):(n.style.opacity="0",n.style.transform="translateY(15px) scale(0.98)",setTimeout(()=>{n.classList.remove("visible"),n.style.display="none"},250)),"flex"===Z?.actionsContainer.style.display&&(Z.actionsContainer.style.display="none")};a.onclick=()=>r(!1);const l=(e,t)=>{const n=document.createElement("div");n.className=`ss-msg ${t}`,n.textContent=e,o.appendChild(n),o.scrollTop=o.scrollHeight};return i.onsubmit=e=>{e.preventDefault();const t=s.value.trim();t&&(l(t,"user"),s.value="",ie(t,ee))},setTimeout(()=>{ue(),window.addEventListener("resize",ue)},100),{panel:n,toggle:r,addMsg:l,host:e}}function ae(){const t="sf-lang-panel";if(document.getElementById(t)||!document.body)return null;const n=document.createElement("div");n.id="simpleform-lang-host",document.body.appendChild(n);const o=n.attachShadow({mode:"open"});o.innerHTML=`\n        <style>\n            #${t} {\n                position: fixed;\n                bottom: 95px;\n                right: 25px;\n                width: 330px;\n                max-height: 480px;\n                display: none;\n                flex-direction: column;\n                background: #ffffff;\n                color: #212529;\n                border-radius: 16px;\n                box-shadow: 0 12px 30px rgba(0,0,0,0.12), 0 6px 15px rgba(0,0,0,0.08);\n                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n                z-index: 2147483647;\n                overflow: hidden;\n                transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;\n                opacity: 0;\n                transform: translateY(15px) scale(0.98);\n            }\n            #${t}.visible {\n                display: flex;\n                opacity: 1;\n                transform: translateY(0) scale(1);\n            }\n            #${t} header {\n                padding: 16px 20px;\n                background-color: #f7f7f7;\n                border-bottom: 1px solid #e0e0e0;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                flex-shrink: 0;\n            }\n            #${t} h2 {\n                margin: 0;\n                font-size: 17px;\n                font-weight: 600;\n            }\n            #${t} header button {\n                background: transparent; border: none; cursor: pointer;\n                color: #555; padding: 5px; border-radius: 50%;\n            }\n            #${t} header button:hover { background-color: rgba(0,0,0,0.05); }\n            #sf-lang-list {\n                flex: 1;\n                overflow-y: auto;\n                padding: 8px 0;\n                margin: 0;\n                list-style: none;\n            }\n            .sf-lang-item {\n                padding: 12px 20px;\n                cursor: pointer;\n                font-size: 14px;\n                border-bottom: 1px solid #f0f0f0;\n            }\n            .sf-lang-item:hover {\n                background-color: #f9f9f9;\n            }\n            .sf-lang-item:last-child {\n                border-bottom: none;\n            }\n            .sf-lang-item.selected {\n                font-weight: 600;\n                color: #116530;\n                background-color: #f0f5f0;\n            }\n        </style>\n        <section id="${t}">\n            <header>\n                <h2>Select Language</h2>\n                <button id="sf-lang-close-btn" aria-label="Close language selection">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>\n                </button>\n            </header>\n            <ul id="sf-lang-list"></ul>\n        </section>\n        `;const i=o.getElementById(t),s=o.getElementById("sf-lang-list"),a=o.getElementById("sf-lang-close-btn"),r=()=>{s.innerHTML='<li class="sf-lang-item" style="cursor:default;color:#777;">Loading languages...</li>',function(){let t=h;if(e.selectedLang){t=`${t}?${new URLSearchParams({language:e.selectedLang}).toString()}`}return fe(t).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}return e.json()}).then(e=>{if(Array.isArray(e))return e;if(Array.isArray(e.languages))return e.languages;throw new Error("Invalid format for languages response")}).catch(e=>(console.warn("Failed to fetch languages:",e),[]))}().then(t=>{if(s.innerHTML="",!t||0===t.length)return void(s.innerHTML='<li class="sf-lang-item" style="cursor:default;color:#777;">Could not load languages.</li>');[{code:null,name:"Auto-detect Language"},...t].forEach(t=>{const n=document.createElement("li");n.className="sf-lang-item",n.textContent=t.name,n.dataset.langCode=t.code||"",(e.selectedLang||t.code)&&e.selectedLang!==t.code||n.classList.add("selected"),n.addEventListener("click",()=>{const t=n.dataset.langCode;t?(localStorage.setItem(S,t),e.selectedLang=t):(localStorage.removeItem(S),e.selectedLang=null),r(),setTimeout(()=>l(!1),200)}),s.appendChild(n)})})},l=e=>{e?(r(),i.classList.add("visible"),i.style.display="flex",requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0) scale(1)"}),ee?.panel.classList.contains("visible")&&ee.toggle(!1)):(i.style.opacity="0",i.style.transform="translateY(15px) scale(0.98)",setTimeout(()=>{i.classList.remove("visible"),i.style.display="none"},250)),"flex"===Z?.actionsContainer.style.display&&(Z.actionsContainer.style.display="none")};return a.onclick=()=>l(!1),setTimeout(()=>{ue(),window.addEventListener("resize",ue)},100),{panel:i,toggle:l,host:n}}function re(e){if(!te){if(console.warn("Language panel not initialized."),!e)return;te=ae()}te&&te.toggle(e)}function le(){Z&&Z.mainButton&&!Z.mainButton.dataset.isLoading&&(Z.mainButton.dataset.originalContent=Z.mainButton.innerHTML,Z.mainButton.innerHTML='\n    <svg width="28" height="28" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#fff" style="display: block; margin: auto;">\n        <g fill="none" fill-rule="evenodd">\n            <g transform="translate(1 1)" stroke-width="3">\n                <circle stroke-opacity=".5" cx="18" cy="18" r="18"/>\n                <path d="M36 18c0-9.94-8.06-18-18-18">\n                    <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/>\n                </path>\n            </g>\n        </g>\n    </svg>',Z.mainButton.dataset.isLoading="true")}function de(){Z&&Z.mainButton&&"true"===Z.mainButton.dataset.isLoading&&(Z.mainButton.dataset.originalContent?Z.mainButton.innerHTML=Z.mainButton.dataset.originalContent:(Z.mainButton.innerHTML="",Z.mainImg&&Z.mainButton.appendChild(Z.mainImg)),delete Z.mainButton.dataset.isLoading,delete Z.mainButton.dataset.originalContent)}function ce(){if(!e.isRecording||!Z||!Z.timerDisplay)return;const t=Date.now()-e.recordingStartTime,n=Math.floor(t/1e3%60).toString().padStart(2,"0"),o=Math.floor(t/6e4).toString().padStart(2,"0");Z.timerDisplay.textContent=`${o}:${n}`}function pe(){if(document.getElementById("tooltipSpeedDial")||!document.body)return Z;let n,o,s,a,r,l,d,c,p,u;const g=document.createElement("div");g.id="tooltipSpeedDial",Object.assign(g.style,{position:"fixed",zIndex:2147483646,display:"flex",alignItems:"center"});const m=document.createElement("div");m.classList.add("tooltip-speed-dial-actions"),Object.assign(m.style,{display:"none",flexDirection:"column",alignItems:"center",gap:"12px"});const f=e=>Object.assign(e.style,{width:"44px",height:"44px",borderRadius:"50%",border:"none",cursor:"pointer",backgroundColor:"#4A5568",color:"#FFFFFF",boxShadow:"0 2px 5px rgba(0,0,0,0.25)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s ease, transform 0.1s ease-out, filter 0.2s ease"}),h=e=>{e.onmouseenter=()=>{e.disabled||(e.style.filter="brightness(1.2)")},e.onmouseleave=()=>{e.disabled||(e.style.filter="brightness(1)")},e.onmousedown=()=>{e.disabled||(e.style.transform="scale(0.95)")},e.onmouseup=()=>{e.disabled||(e.style.transform="scale(1)")}};if(e.businessSettings?.showVideoRecording){const t=document.createElement("div");Object.assign(t.style,{display:"flex",gap:"12px",alignItems:"center"}),p=document.createElement("button"),p.id="cameraBtn",f(p),h(p),u=document.createElement("button"),u.id="micBtn",f(u),h(u),r=document.createElement("button"),r.id="playPauseBtn",f(r),h(r),l=document.createElement("button"),l.id="sendBtn",l.innerHTML=x,l.setAttribute("title","Finish and Send Recording"),f(l),h(l),d=document.createElement("button"),d.id="eraseBtn",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>',d.setAttribute("title","Cancel Recording"),f(d),h(d),c=document.createElement("div"),c.id="timerDisplay",Object.assign(c.style,{fontSize:"14px",color:"#FFFFFF",backgroundColor:"rgba(0,0,0,0.5)",padding:"4px 8px",borderRadius:"4px"});const n=(t,n,o,i)=>{t.innerHTML=o,t.setAttribute("title",i);const s=()=>{const o=e[n];t.style.backgroundColor=o?"#38A169":"#4A5568"};return t.addEventListener("click",t=>{t.stopPropagation();const o=!e[n];if(e[n]=o,e.isRecording&&e.userStream){const t="isCameraEnabled"===n?"video":"audio",i=e.userStream.getTracks().find(e=>e.kind===t);if(i){i.enabled=o;const e=z();e&&"video"===t&&(e.style.display=i.enabled?"block":"none")}}s()}),s},o=n(p,"isCameraEnabled",'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4zM15 16H5V8h10v8zm-6-1.82c1.43 0 2.59-1.16 2.59-2.58s-1.16-2.59-2.59-2.59-2.59 1.16-2.59 2.59 1.16 2.59 2.59 2.59z"/></svg>',"Toggle Camera"),i=n(u,"isMicEnabled",'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>',"Toggle Microphone"),s=()=>{const t=e.isRecording,n=e.recordedChunks.length>0,o=t||n;p.style.display=o?"none":"flex",u.style.display=o?"none":"flex";const i=e.isRecording||e.isPaused;r.style.display="flex",l.style.display=e.isPaused?"flex":"none",d.style.display=i?"flex":"none",c.style.display=i?"block":"none"},a=()=>{ne&&clearInterval(ne),ne=null,r.innerHTML=E,r.setAttribute("title","Start Recording"),o(),i(),s()};r.addEventListener("click",async t=>{if(t.stopPropagation(),e.isRecording)e.isPaused?("paused"===e.mediaRecorder?.state&&(e.mediaRecorder.resume(),e.isPaused=!1),r.innerHTML=C,r.setAttribute("title","Pause Recording"),ne&&clearInterval(ne),ne=setInterval(ce,1e3)):("recording"===e.mediaRecorder?.state&&(e.mediaRecorder.pause(),e.isPaused=!0),r.innerHTML=E,r.setAttribute("title","Resume Recording"),ne&&clearInterval(ne));else try{await P(),r.innerHTML=C,r.setAttribute("title","Pause Recording"),ne&&clearInterval(ne),ne=setInterval(ce,1e3),o(),i()}catch(e){return console.error("Failed to start recording from UI:",e),void a()}s()}),l.addEventListener("click",t=>{t.stopPropagation(),e.mediaRecorder&&"inactive"!==e.mediaRecorder.state?(e.mediaRecorder.stream.getTracks().forEach(e=>e.stop()),e.mediaRecorder.stop()):M(),e.isRecording=!1,e.isPaused=!1,a()}),d.addEventListener("click",t=>{t.stopPropagation(),e.mediaRecorder&&"inactive"!==e.mediaRecorder.state?(e.recordedChunks=[],e.mediaRecorder.stream.getTracks().forEach(e=>e.stop()),e.mediaRecorder.stop()):M(),e.isRecording=!1,e.isPaused=!1,e.recordingStartTime=null,e.mediaRecorder=null,a()}),t.appendChild(d),t.appendChild(p),t.appendChild(u),t.appendChild(r),t.appendChild(c),t.appendChild(l),m.appendChild(t),a()}const b=document.createElement("div");Object.assign(b.style,{display:"none",flexDirection:"column",alignItems:"center",gap:"12px"});const v=document.createElement("button");f(v),h(v),v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>',v.setAttribute("aria-label","Move Widget"),v.setAttribute("title","Move Widget"),v.addEventListener("click",e=>{e.stopPropagation(),m.style.display="none",b.style.display="flex"}),m.appendChild(v);[{pos:"top-left",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M4 4h7v7H4z"/></svg>',label:"Move to Top Left"},{pos:"top-right",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M13 4h7v7h-7z"/></svg>',label:"Move to Top Right"},{pos:"bottom-left",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M4 13h7v7H4z"/></svg>',label:"Move to Bottom Left"},{pos:"bottom-right",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M13 13h7v7h-7z"/></svg>',label:"Move to Bottom Right"}].forEach(({pos:t,svg:n,label:o})=>{const i=document.createElement("button");f(i),h(i),i.innerHTML=n,i.setAttribute("aria-label",o),i.setAttribute("title",o),i.addEventListener("click",n=>{n.stopPropagation(),e.speedDialPosition=t,localStorage.setItem(k,t),ue(),b.style.display="none",m.style.display="flex"}),b.appendChild(i)});const S=document.createElement("button");f(S),h(S),S.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',S.setAttribute("aria-label","Back to options"),S.setAttribute("title","Back"),S.addEventListener("click",e=>{e.stopPropagation(),b.style.display="none",m.style.display="flex"}),b.appendChild(S),e.businessSettings?.showTooltips&&(n=document.createElement("button"),f(n),h(n),n.addEventListener("click",t=>{t.stopPropagation(),window.SimpleFormSDK.toggleTooltips(!e.tooltipsEnabled),m.style.display="none"}),m.appendChild(n)),e.businessSettings?.showSupportChat&&(o=document.createElement("button"),o.id="ss-chat-btn-speeddial",o.setAttribute("aria-label","Open Support Chat"),o.setAttribute("title","Open Support Chat"),f(o),h(o),o.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg"\n     viewBox="0 0 24 24"\n     width="22" height="22"\n     fill="currentColor">\n  <path d="M12 1A10 10 0 0 0 2 11v3a2 2 0 0 0 2 2h2v-6H4v-1\n           a8 8 0 0 1 16 0v1h-2v6h2a2 2 0 0 0 2-2v-3\n           A10 10 0 0 0 12 1z"/>\n  <path d="M7 13h2v4H7zm8 0h2v4h-2z"/>\n</svg>',o.addEventListener("click",e=>{e.stopPropagation(),ee||(ee=se()),ee&&ee.toggle(!0),m.style.display="none"}),m.appendChild(o)),e.businessSettings?.showLanguageSelector&&(s=document.createElement("button"),s.setAttribute("aria-label","Select Language"),s.setAttribute("title","Select TTS Language"),f(s),h(s),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4.84 19l5.05-5.05.03.03 6.12-6.12 2.83 2.83z"/></svg>',s.addEventListener("click",e=>{e.stopPropagation(),re(!0),m.style.display="none"}),m.appendChild(s)),e.businessSettings?.showPageTranslation&&(a=document.createElement("button"),a.setAttribute("aria-label","Translate Page"),a.setAttribute("title","Translate Page"),f(a),h(a),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>',a.addEventListener("click",t=>{if(t.stopPropagation(),!e.selectedLang||"en"===e.selectedLang)return void alert("Please select a target language other than English first.");a.disabled=!0,le();const n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:function(e){const t=e.parentElement;return!t||"SCRIPT"===t.tagName||"STYLE"===t.tagName||t.closest('[aria-hidden="true"]')||0===t.offsetWidth||0===t.offsetHeight||""===e.nodeValue.trim()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),o=[];for(;n.nextNode();)o.push(n.currentNode);0===e.originalTextNodes.size&&o.forEach(t=>e.originalTextNodes.set(t,t.nodeValue));const i=[...new Set(o.map(e=>e.nodeValue))],s=[];for(let e=0;e<i.length;e+=50)s.push(i.slice(e,e+50));Promise.all(s.map(t=>{return n=t,o=e.selectedLang,new Promise((t,i)=>{const s={"Content-Type":"application/json",Accept:"application/json",...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`}};fetch(y,{method:"POST",headers:s,body:JSON.stringify({texts:n,target_language:o})}).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}t(e.json())}).catch(i)});var n,o})).then(e=>{const t=e.reduce((e,t)=>({...e,...t.translations}),{});o.forEach(e=>{t[e.nodeValue]&&(e.nodeValue=t[e.nodeValue])}),console.log("Page translation complete.")}).catch(e=>{console.error("Page translation failed:",e),alert("Sorry, the page could not be translated.")}).finally(()=>{de(),a.disabled=!1,m.style.display="none"})}),m.appendChild(a));const T=document.createElement("button");T.setAttribute("aria-label","Refresh all tooltips"),T.setAttribute("title","Refresh all tooltips"),f(T),h(T),T.innerHTML=w,T.addEventListener("click",n=>{if(n.stopPropagation(),!e.tooltipsEnabled)return;T.disabled=!0,Object.assign(T.style,{opacity:"0.6",cursor:"not-allowed"});he(X()).then(e=>{t(e),i(),Q(),J()}).catch(e=>console.log("Error refreshing all tooltips:",e)).finally(()=>{T.disabled=!1,Object.assign(T.style,{opacity:"1",cursor:"pointer"}),m.style.display="none"})}),m.appendChild(T);const L=document.createElement("button");L.id="tooltipSpeedDial_mainButton",L.setAttribute("aria-label","Open options"),L.setAttribute("title","Options"),Object.assign(L.style,{width:"56px",height:"56px",borderRadius:"50%",border:"none",cursor:"pointer",backgroundColor:"#1A202C",color:"#FFFFFF",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.3s ease-in-out, background-color 0.2s ease",opacity:"1",padding:"0",overflow:"hidden"}),L.onmouseenter=()=>{L.dataset.isLoading||(L.style.backgroundColor="#2D3748")},L.onmouseleave=()=>{L.dataset.isLoading||(L.style.backgroundColor="#1A202C")};const R=document.createElement("img");R.alt="Tooltip Icon",Object.assign(R.style,{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"});try{R.src=function(){try{const e=window.getComputedStyle(document.body).backgroundColor.match(/\d+/g);if(e&&e.length>=3){const[t,n,o]=e.map(e=>parseInt(e,10));return(299*t+587*n+114*o)/1e3>128}}catch(e){console.warn("Could not determine background color, defaulting to light.",e)}return!0}()?"icon128.png":"SC_COLOR.png"}catch(e){console.warn("Could not load main FAB icon.",e)}return L.appendChild(R),L.addEventListener("click",()=>{if("true"===L.dataset.isLoading)return;const e=ee?.panel.classList.contains("visible"),t=te?.panel.classList.contains("visible"),n="flex"===m.style.display,o="flex"===b.style.display;if(e||t)return e&&ee.toggle(!1),t&&re(!1),m.style.display="none",void(b.style.display="none");if(n||o)m.style.display="none",b.style.display="none";else if(m.style.display="flex",r){const e=new Event("updatevisibility");r.dispatchEvent(e)}}),g.appendChild(m),g.appendChild(b),g.appendChild(L),document.body.appendChild(g),!ee&&o&&(ee=se()),!te&&s&&(te=ae()),Z={speedDial:g,mainButton:L,actionsContainer:m,moveOptionsContainer:b,moveButton:v,toggleTooltipsButton:n,refreshButton:T,supportChatButton:o,languageButton:s,mainImg:R,playPauseButton:r,sendButton:l,eraseButton:d,timerDisplay:c,cameraButton:p,micButton:u,translatePageButton:a},ue(),new MutationObserver(ue).observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("resize",ue),Z}function ue(){if(!Z||!Z.speedDial)return;const t=Z.speedDial,n=Z.actionsContainer,o=Z.moveOptionsContainer,i=e.speedDialPosition,s="25px",a="12px";t.style.top="auto",t.style.bottom="auto",t.style.left="auto",t.style.right="auto",i.includes("bottom")?(t.style.bottom=s,t.style.flexDirection="column-reverse",n.style.marginBottom=a,n.style.marginTop="auto",o.style.marginBottom=a,o.style.marginTop="auto"):(t.style.top=s,t.style.flexDirection="column",n.style.marginTop=a,n.style.marginBottom="auto",o.style.marginTop=a,o.style.marginBottom="auto"),i.includes("left")?t.style.left=s:t.style.right=s,requestAnimationFrame(()=>{const e=t.getBoundingClientRect();[ee?.panel,te?.panel].forEach(t=>{t&&(t.style.top="auto",t.style.bottom="auto",t.style.left="auto",t.style.right="auto",i.includes("bottom")?t.style.bottom=window.innerHeight-e.top+15+"px":t.style.top=`${e.bottom+15}px`,i.includes("left")?t.style.left=`${e.left}px`:t.style.right=window.innerWidth-e.right+"px")})})}function ge(e){Z&&Z.mainButton&&(Z.toggleTooltipsButton&&(e?(Z.toggleTooltipsButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 13C8.69 17.5 6 15.08 6 12s2.69-5.5 6-5.5 6 2.42 6 6-2.69 5.5-6 5.5zm0-9c-1.93 0-3.5 1.57-3.5 3.5S10.07 15.5 12 15.5 15.5 13.93 15.5 12 13.93 8.5 12 8.5z"/></svg>',Z.toggleTooltipsButton.setAttribute("aria-label","Disable Tooltips"),Z.toggleTooltipsButton.setAttribute("title","Disable Tooltips")):(Z.toggleTooltipsButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>',Z.toggleTooltipsButton.setAttribute("aria-label","Enable Tooltips"),Z.toggleTooltipsButton.setAttribute("title","Enable Tooltips"))),Z.mainButton.title="Options",Z.mainButton.style.opacity="1",Z.refreshButton&&(Z.refreshButton.disabled=!e,Z.refreshButton.style.opacity=e?"1":"0.6",Z.refreshButton.style.cursor=e?"pointer":"not-allowed",Z.refreshButton.title=e?"Refresh all tooltips":"Tooltips disabled, cannot refresh"),Z.supportChatButton&&(Z.supportChatButton.disabled=!1,Z.supportChatButton.style.opacity="1",Z.supportChatButton.style.cursor="pointer",Z.supportChatButton.title="Open Support Chat"),Z.languageButton&&(Z.languageButton.disabled=!1,Z.languageButton.style.opacity="1",Z.languageButton.style.cursor="pointer",Z.languageButton.title="Select TTS Language"))}function me(e){if(!Z||!Z.speedDial){if(e&&!document.getElementById("tooltipSpeedDial")){if(pe(),!Z||!Z.speedDial)return}else if(!e&&document.getElementById("tooltipSpeedDial")){const e=document.getElementById("tooltipSpeedDial");e&&(e.style.display="none")}if(!Z||!Z.speedDial)return}Z.speedDial.style.display=e?"flex":"none",e||(Z.actionsContainer&&(Z.actionsContainer.style.display="none"),Z.moveOptionsContainer&&(Z.moveOptionsContainer.style.display="none"),ee?.panel.classList.contains("visible")&&ee.toggle(!1),te?.panel.classList.contains("visible")&&re(!1))}function fe(t,n={}){return new Promise((o,i)=>{const s="true"===Z?.mainButton?.dataset?.isLoading;B()||0!==e.activeFetches||s||le(),e.activeFetches++;const a={...n.headers,...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`}};fetch(t,{...n,headers:a}).then(o).catch(i).finally(()=>{e.activeFetches--,B()||0!==e.activeFetches||s||de()})})}function he(t=[]){if(!Array.isArray(t)||0===t.length)return Promise.resolve({});const n=[...new Set(t)].filter(e=>"string"==typeof e&&""!==e.trim());return 0===n.length?Promise.resolve({}):fe(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:n,language:e.selectedLang||null})}).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}return e.json()}).catch(e=>(console.warn("Tooltip lookup failed:",e),{}))}function be({apiBaseUrl:e=u,fetchWithAuthFn:t=fe}={}){if(console.log("SimpleForm SDK: Initializing form tracker..."),be._initialized)return be._dispose||(()=>{});be._initialized=!0;const n=`${e}/forms/submissions`,o=new WeakMap,i=new WeakMap;let s,a;const r=e=>{if(!n)return;const o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t(n,o,{keepalive:!0}).catch(e=>console.error("Form tracking request failed:",e))},l=e=>{if(!(e instanceof HTMLFormElement))return;if(o.has(e))return;s.observe(e);const t=(e=>t=>{const n=o.get(e);if(!n)return;const i=Date.now()-n.startTime,s={submissionId:n.submissionId,submittedAt:(new Date).toISOString(),durationMs:i,formIdentifier:n.formIdentifier,pageUrl:window.location.href,status:"submitted"};r(s)})(e);i.set(e,t),e.addEventListener("submit",t)};return s=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(!e.isIntersecting)return;const n=e.target,i="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),s=Date.now(),a=(e=>{if(e.id)return e.id;if(e.name)return e.name;const t=e.getAttribute("action");return t?`form-action-${t}`:`form-on-${window.location.pathname}`})(n);o.set(n,{submissionId:i,startTime:s,formIdentifier:a});const l={submissionId:i,formIdentifier:a,status:"viewed",openedAt:new Date(s).toISOString(),pageUrl:window.location.href};r(l),t.unobserve(n)})},{threshold:.1}),a=new MutationObserver(e=>{for(const t of e)t.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&("FORM"===e.tagName&&l(e),e.querySelectorAll?.("form")?.forEach(l))})}),document.querySelectorAll("form").forEach(l),a.observe(document.body,{childList:!0,subtree:!0}),console.log(`SimpleForm SDK: Form tracking enabled. Sending data to ${n}`),be._dispose=()=>{try{s?.disconnect(),a?.disconnect(),document.querySelectorAll("form").forEach(e=>{const t=i.get(e);t&&e.removeEventListener("submit",t)})}finally{be._initialized=!1}},be._dispose}function ye(t,n,o="success"){e.temporaryTooltipRef&&(e.temporaryTooltipRef.dataset.autoCloseTimer&&clearTimeout(parseInt(e.temporaryTooltipRef.dataset.autoCloseTimer)),c(),e.temporaryTooltipRef.remove(),a(null));const i=document.createElement("div");i.setAttribute("role","error"===o?"alert":"status"),i.id="temporary-selection-tooltip",Object.assign(i.style,{position:"absolute",padding:"6px 12px",backgroundColor:"success"===o?"rgba(30, 41, 59, 0.95)":"rgba(185, 28, 28, 0.95)",color:"#f1f5f9",borderRadius:"6px",fontSize:"13px",fontFamily:"sans-serif",zIndex:2147483647,maxWidth:"350px",wordWrap:"break-word",boxShadow:"0 4px 10px rgba(0,0,0,0.3)",pointerEvents:"auto",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:0,transform:"translateY(5px)",transition:"opacity 0.2s ease-out, transform 0.2s ease-out",lineHeight:"1.4",display:"flex",alignItems:"center"});const s=document.createElement("span");if(s.textContent=t,s.style.flexGrow="1",s.style.paddingRight=p()&&"success"===o?"52px":"20px",i.appendChild(s),p()&&"success"===o){const t=document.createElement("button");Object.assign(t.style,{background:"transparent",border:"none",cursor:"pointer",padding:"0",color:"rgba(255, 255, 255, 0.7)",marginLeft:"8px",position:"absolute",right:"24px",top:"50%",transform:"translateY(-50%)",lineHeight:"1"}),t.innerHTML=v,t.setAttribute("aria-label","Read definition aloud"),t.setAttribute("title","Read aloud"),t.onmouseenter=()=>t.style.color="rgba(255, 255, 255, 1)",t.onmouseleave=()=>t.style.color="rgba(255, 255, 255, 0.7)",t.onclick=t=>{t.stopPropagation();d(s.textContent,null),e.temporaryTooltipRef&&e.temporaryTooltipRef.dataset.autoCloseTimer&&(clearTimeout(parseInt(e.temporaryTooltipRef.dataset.autoCloseTimer)),e.temporaryTooltipRef.dataset.autoCloseTimer="")},i.appendChild(t)}const r=document.createElement("button");Object.assign(r.style,{position:"absolute",top:"3px",right:"3px",background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"18px",cursor:"pointer",padding:"0 4px",lineHeight:"1",fontWeight:"bold",borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"}),r.textContent="×",r.setAttribute("aria-label","Close definition"),r.onmouseenter=()=>r.style.color="rgba(255, 255, 255, 1)",r.onmouseleave=()=>r.style.color="rgba(255, 255, 255, 0.7)",r.onclick=t=>{t.stopPropagation(),e.temporaryTooltipRef&&(c(),e.temporaryTooltipRef.style.opacity="0",e.temporaryTooltipRef.style.transform="translateY(5px)",e.temporaryTooltipRef.dataset.autoCloseTimer&&clearTimeout(parseInt(e.temporaryTooltipRef.dataset.autoCloseTimer)),setTimeout(()=>{e.temporaryTooltipRef&&e.temporaryTooltipRef.remove(),a(null)},200))},i.appendChild(r);let l=((n=n||{bottom:window.innerHeight/2+10,left:window.innerWidth/2,top:window.innerHeight/2-10}).bottom||n.top||0)+window.scrollY+8,u=(n.left||0)+window.scrollX;document.body.appendChild(i),a(i);const g=i.getBoundingClientRect(),m=window.innerWidth,f=window.innerHeight,h=window.scrollX,b=window.scrollY;l+g.height>f+b-5&&(l=(n.top||0)+b-g.height-8),l<b+5&&(l=b+5),u-=g.width/2,u<h+5&&(u=h+5),u+g.width>m+h-5&&(u=m+h-g.width-5),i.style.top=`${l}px`,i.style.left=`${u}px`,requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.style.opacity=1,i.style.transform="translateY(0)"})});const y=setTimeout(()=>{e.temporaryTooltipRef===i&&(c(),r.click())},"success"===o?15e3:8e3);i.dataset.autoCloseTimer=y.toString()}var ve=null,we=null;function xe(){window.MutationObserver?(ve&&ve.disconnect(),(ve=new MutationObserver(o=>{we&&clearTimeout(we),we=setTimeout(()=>{if(!e.tooltipsEnabled)return;let i=[];o.forEach(e=>{if(e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches?.(R)&&i.push(e),i.push(...e.querySelectorAll?.(R)))}),"attributes"===e.type&&e.target.nodeType===Node.ELEMENT_NODE&&e.target.matches?.(R)&&("disabled"===e.attributeName||"id"===e.attributeName||"name"===e.attributeName||"data-tooltip-key"===e.attributeName||"placeholder"===e.attributeName)){if("true"===e.target.dataset.tooltipInjected){const t=e.target.nextElementSibling;t&&t.classList.contains("tooltip-icon-container")&&t.remove(),e.target.dataset.tooltipInjected="false",delete e.target.dataset.keyUsed}i.push(e.target)}}),i.length>0&&function(e){if(0===e.length)return;const o=[...new Set(e)].filter(e=>null!==e.offsetParent&&!e.disabled&&e.closest("form")&&"true"!==e.dataset.tooltipInjected);if(o.length>0){const e=o.map(e=>{const t=A(e);return t&&(e.dataset.potentialKey=t),t}).filter(e=>e&&!n(e)),i=[...new Set(e)],s=()=>{o.forEach(e=>{if(null!==e.offsetParent&&!e.disabled&&e.closest("form")&&"true"!==e.dataset.tooltipInjected){const t=e.dataset.potentialKey||A(e);t&&n(t)&&Y(e),delete e.dataset.potentialKey}})};i.length>0?(console.log("Fetching tooltips for dynamically added/updated keys:",i),he(i).then(e=>{t(e),s()}).catch(e=>{console.log("Error fetching dynamic tooltips:",e),s()})):s()}}(i.filter(Boolean))},500)})).observe(document.body||document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["disabled","style","class","id","name","data-tooltip-key","placeholder"]}),console.log("MutationObserver initialized for dynamic fields.")):console.warn("MutationObserver not supported, dynamic fields won't get tooltips automatically.")}function Ee(){ve&&(ve.disconnect(),ve=null,we&&clearTimeout(we),console.log("MutationObserver disconnected."))}window.addEventListener("beforeunload",()=>{c(),Ee();const e=document.getElementById("form-tooltip-container");e&&e.remove();const t=document.getElementById("tooltipSpeedDial");t&&t.remove();const n=document.getElementById("temporary-selection-tooltip");n&&n.remove(),console.log("Tooltip system resources cleaned up.")}),window.SimpleFormSDK={init:function n(o={}){if(!document.body)return console.warn("Document body not ready for SDK initialization. Retrying..."),void setTimeout(()=>n(o),100);console.log("Initializing SimpleForm SDK..."),o.apiKey?(e.apiKey=o.apiKey,fe(b).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>""),n=t?`API error ${e.status}: ${t}`:`API error ${e.status}`;throw new Error(n)}return e.json()}).catch(e=>(console.warn("Failed to fetch business details:",e),null)).then(n=>{if(e.businessSettings=n,n&&n.showSpeedDial){console.log("SimpleForm SDK is enabled by business settings."),e.speedDialEnabledGlobal=!0,r.synth?(l(),void 0!==r.synth.onvoiceschanged?r.synth.onvoiceschanged=l:console.warn("speechSynthesis.onvoiceschanged not supported, voices might load late or require manual re-check.")):console.warn("Web Speech API (speechSynthesis) not supported by this browser."),be();const i=n.showTooltips??!0;if(i){const t=localStorage.getItem(T);e.tooltipsEnabled="false"!==t}else e.tooltipsEnabled=!1;const a=localStorage.getItem(S);a?e.selectedLang=a:(e.selectedLang="en",localStorage.setItem(S,"en"));const d=localStorage.getItem(k);if(d&&(e.speedDialPosition=d),i){const e=N();e&&s(e)}const c=pe();if(c&&(o=c,e.speedDialRef=o),n.logo_url&&e.speedDialRef&&e.speedDialRef.mainImg&&(e.speedDialRef.mainImg.src=n.logo_url),e.tooltipsEnabled){const e=X();e.length>0?he(e).then(e=>{t(e),J()}).catch(e=>{console.log("Initial tooltip data fetch failed:",e),J()}).finally(()=>{xe()}):(J(),xe())}else console.log("Tooltips are disabled by business or user setting.");ge(e.tooltipsEnabled),me(!0),ue(),console.log("SimpleForm SDK initialization complete.")}else{console.log("SimpleForm SDK is disabled by business settings."),e.speedDialEnabledGlobal=!1,e.tooltipsEnabled=!1;const t=document.getElementById("tooltipSpeedDial");t&&t.remove();const n=document.getElementById("form-tooltip-container");n&&n.remove(),Q(),Ee()}var o}).catch(t=>{console.error("Failed to fetch business details; SDK will not be activated.",t),e.speedDialEnabledGlobal=!1,e.tooltipsEnabled=!1,Ee()})):console.error("SimpleForm SDK: API key is required for initialization.")},toggleTooltips:function(n){localStorage.setItem(T,String(n));const o=e.tooltipsEnabled!==n;if(e.tooltipsEnabled=n,!o&&document.querySelector(".tooltip-icon-container"))if(n&&!document.querySelector(".tooltip-icon-container"));else{if(!n&&document.querySelector(".tooltip-icon-container"))return Q(),void ge(n);if(n&&document.querySelector(".tooltip-icon-container"))return}if(n){if(console.log("Form field tooltips enabled. Processing fields..."),Q(),i(),!e.tooltipRefGlobal||!document.getElementById("form-tooltip-container")){const e=N();e&&s(e)}const n=X();n.length>0?he(n).then(e=>{t(e),J(),console.log(`Processed ${Object.keys(e).length} tooltips on enable.`)}).catch(e=>{console.log("Error fetching tooltips on enable:",e),J()}).finally(()=>{xe()}):(J(),xe())}else Q(),Ee(),console.log("Form field tooltips disabled.");ge(n),e.speedDialRef&&me(e.speedDialEnabledGlobal)},fetchAndShowSelectedTextTooltip:async function(){if(!e.tooltipsEnabled)return void console.log("Tooltips disabled, cannot fetch definition for selection.");const t=window.getSelection(),n=t?.toString().trim();if(!n)return void console.log("No text selected for definition lookup.");let o,i;try{if(!t||0===t.rangeCount)throw new Error("No range in selection");o=t.getRangeAt(0);const e=o.getClientRects();if(i=e.length>0?e[0]:o.getBoundingClientRect(),i={top:i.top,bottom:i.bottom,left:i.left,width:i.width,height:i.height},0===i.width&&0===i.height&&e.length<=1)throw new Error("Selection rect has zero dimensions.")}catch(e){console.warn("Could not get precise selection geometry, using fallback position.",e),i={top:window.innerHeight/2-10,bottom:window.innerHeight/2+10,left:window.innerWidth/2,width:0,height:0}}if(n.length>250)return console.log("Selected text exceeds maximum length of 250."),void ye(`Selection too long (max 250 chars). Selected ${n.length}.`,i,"error");ye("Fetching definition...",i,"success");try{const e=await he([n]),t=e?e[n]:null;t?ye(t,i,"success"):ye(`No definition found for "${n}"`,i,"error")}catch(e){console.log("Error fetching selected text tooltip:",e),ye("Error fetching definition.",i,"error")}}}})();